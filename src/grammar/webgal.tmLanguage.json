{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "WebGAL Script",
  "patterns": [
    {
      "include": "#comment-line"
    },
    {
      "include": "#statement"
    }
  ],
  "repository": {
    "argument-list": {
      "patterns": [
        {
          "comment": ">1 arguments left, ie -kwarg0=val0 -kwarg1=val1 ...",
          "match": "(\\s\\-)(.*?)(\\s\\-.*)$",
          "captures": {
            "1": {
              "patterns": [
                {
                  "include": "#operator"
                }
              ]
            },
            "2": {
              "patterns": [
                {
                  "include": "#parameter"
                }
              ]
            },
            "3": {
              "patterns": [
                {
                  "include": "#argument-list"
                }
              ]
            }
          }
        },
        {
          "comment": "only one argument left, ie -kwarg0=val0",
          "match": "(\\s\\-)(.*)",
          "captures": {
            "1": {
              "patterns": [
                {
                  "include": "#operator"
                }
              ]
            },
            "2": {
              "patterns": [
                {
                  "include": "#parameter"
                }
              ]
            }
          }
        }
      ]
    },
    "character": {
      "match": ".*",
      "name": "markup.changed"
    },
    "command": {
      "match": ".*",
      "name": "punctuation.definition.character-class.regexp"
    },
    "comment-line": {
      "match": "\\;.*?$",
      "name": "comment"
    },
    "operator": {
      "match": "[\\:\\=\\<\\>\\|\\+\\-]",
      "name": "markup.deleted"
    },
    "parameter": {
      "patterns": [
        {
          "comment": "value only, ie val0",
          "match": "(?!.*\\=).+",
          "name": "markup.changed"
        },
        {
          "comment": "name and value, ie [kwarg0]=[val0]",
          "match": "(.*?)(\\=)(.*?)$",
          "captures": {
            "1": {
              "name": "markup.changed"
            },
            "2": {
              "patterns": [
                {
                  "include": "#operator"
                }
              ]
            },
            "3": {
              "name": "markup.inserted"
            }
          }
        }
      ]
    },
    "utterance": {
      "patterns": [
        {
          "comment": "utterance only",
          "match": "(?!.*\\s\\-)(.+)",
          "captures": {
            "0": {
              "name": "string.regexp"
            }
          }
        },
        {
          "comment": "utterance and argument list",
          "match": "(.*?)(\\s\\-.*?)$",
          "captures": {
            "1": {
              "name": "string.regexp"
            },
            "2": {
              "patterns": [
                {
                  "include": "#argument-list"
                }
              ]
            }
          }
        }
      ]
    },
    "character-colon": {
      "comment": "[char]:[utt[ -args]][;cmt]",
      "match": "^(?!(?:say|changeBg|changeFigure|bgm|playVideo|pixiPerform|pixiInit|intro|miniAvatar|changeScene|choose|end|setComplexAnimation|setFilter|label|jumpLabel|chooseLabel|setVar|if|callScene|showVars|unlockCg|unlockBgm|filmMode|setTextbox|setAnimation|playEffect|setTempAnimation|comment|setTransform|setTransition|getUserInput|applyStyle|wait)\\:)(.*?)(\\:)([^\\;\\n]*?)($|\\;.*?$)",
      "captures": {
        "1": {
          "name": "meta.character.webgal",
          "patterns": [
            {
              "include": "#character"
            }
          ]
        },
        "2": {
          "patterns": [
            {
              "include": "#operator"
            }
          ]
        },
        "3": {
          "patterns": [
            {
              "include": "#utterance"
            }
          ]
        },
        "4": {
          "patterns": [
            {
              "include": "#comment-line"
            }
          ]
        }
      }
    },
    "command-colon": {
      "comment": "cmd:[arg0[ -args]][;cmt]",
      "match": "^(say|changeBg|changeFigure|bgm|playVideo|pixiPerform|pixiInit|intro|miniAvatar|changeScene|choose|end|setComplexAnimation|setFilter|label|jumpLabel|chooseLabel|setVar|if|callScene|showVars|unlockCg|unlockBgm|filmMode|setTextbox|setAnimation|playEffect|setTempAnimation|comment|setTransform|setTransition|getUserInput|applyStyle|wait)(\\:)([^\\;\\n]*?)($|\\;.*?$)",
      "captures": {
        "1": {
          "name": "meta.command.webgal",
          "patterns": [
            {
              "include": "#command"
            }
          ]
        },
        "2": {
          "patterns": [
            {
              "include": "#operator"
            }
          ]
        },
        "3": {
          "patterns": [
            {
              "include": "#argument-list"
            }
          ]
        },
        "4": {
          "patterns": [
            {
              "include": "#comment-line"
            }
          ]
        }
      }
    },
    "command-semicolon": {
      "comment": "cmd;[cmt]",
      "match": "^(say|changeBg|changeFigure|bgm|playVideo|pixiPerform|pixiInit|intro|miniAvatar|changeScene|choose|end|setComplexAnimation|setFilter|label|jumpLabel|chooseLabel|setVar|if|callScene|showVars|unlockCg|unlockBgm|filmMode|setTextbox|setAnimation|playEffect|setTempAnimation|comment|setTransform|setTransition|getUserInput|applyStyle|wait)($|\\;.*?$)",
      "captures": {
        "1": {
          "name": "meta.command.webgal",
          "patterns": [
            {
              "include": "#command"
            }
          ]
        },
        "2": {
          "patterns": [
            {
              "include": "#comment-line"
            }
          ]
        }
      }
    },
    "utterance-semicolon": {
      "comment": "utt[ -args];[cmt]",
      "match": "^(?!(?:say|changeBg|changeFigure|bgm|playVideo|pixiPerform|pixiInit|intro|miniAvatar|changeScene|choose|end|setComplexAnimation|setFilter|label|jumpLabel|chooseLabel|setVar|if|callScene|showVars|unlockCg|unlockBgm|filmMode|setTextbox|setAnimation|playEffect|setTempAnimation|comment|setTransform|setTransition|getUserInput|applyStyle|wait)\\;)([^\\:\\;\n]+?)(\\;.*)?$",
      "captures": {
        "1": {
          "patterns": [
            {
              "include": "#utterance"
            }
          ]
        },
        "2": {
          "patterns": [
            {
              "include": "#comment-line"
            }
          ]
        }
      }
    },
    "statement": {
      "patterns": [
        {
          "include": "#character-colon"
        },
        {
          "include": "#command-colon"
        },
        {
          "include": "#command-semicolon"
        },
        {
          "include": "#utterance-semicolon"
        }
      ]
    }
  },
  "scopeName": "source.webgal"
}
